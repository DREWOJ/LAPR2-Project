@startuml US02_SD
autonumber
'hide footbox
actor "Receptionist" as RECEPT

participant ":AppointmentUI" as UI
participant ":AppointmentController" as CTRL
participant "comp\n:Company" as COMP
participant "mapper\n:AppointmentMapper" as MAPPER
participant "appDto:AppointmentDto" as DTO
participant "store\n:VaccineTypeStore" as VACSTORE
participant "store\n:SNSUserStore" as SNSSTORE
participant "store\n:AppointmentStore" as APPSTORE
participant "appointment\n:Appointment" as APPOINT

activate RECEPT
RECEPT -> UI : asks to schedule a vaccination
activate UI

UI --> RECEPT : requests data (SNSUserNumber, date, time)
deactivate UI

RECEPT -> UI : types requested data
activate UI

UI -> CTRL : getSuggestedVaccine()
activate CTRL

CTRL -> COMP : sugVac = getSuggestedVaccine()
activate COMP
deactivate CTRL
deactivate COMP

UI --> RECEPT : shows suggested vaccine type and asks to accept it
deactivate UI

RECEPT -> UI : accepts the suggested vaccine type
activate UI

UI -> CTRL : getVaccineTypeStore()
activate CTRL

CTRL -> COMP : getVaccineTypeStore()
activate COMP
deactivate COMP

CTRL -> VACSTORE : vacList = getVaccineList()
activate VACSTORE
deactivate VACSTORE
deactivate CTRL


opt declines the suggested vaccine type
UI --> RECEPT : shows all vaccine types and asks to select one
deactivate UI

RECEPT -> UI : selects a vaccine type
activate UI

UI -> CTRL : getVaccineTypeByCode(code)
activate CTRL

CTRL -> VACSTORE : getVaccineTypeByCode(code)
activate VACSTORE
deactivate VACSTORE
deactivate CTRL
end

UI --> RECEPT : asks to send sms with information about the scheduled vaccine
deactivate UI
RECEPT -> UI : accepts or declines the sending sms
activate UI

UI -> CTRL : createAppointment(dto)
activate CTRL

note right 
dto has all information (SNSUserNumber,date,time,vaccineType,SMS)
end note
CTRL -> COMP : vacSchedule = createAppointment(dto)
activate COMP


COMP -> MAPPER : vacSchedule = toDto(dto)
activate MAPPER
deactivate COMP

MAPPER -> DTO : SNSUserNumber = getSNSNumber()
activate DTO
deactivate DTO

MAPPER -> DTO : date = getDate()
activate DTO
deactivate DTO

MAPPER -> DTO : time = getTime()
activate DTO
deactivate DTO

MAPPER -> DTO : center=getVaccinationCenter()
activate DTO
deactivate DTO

MAPPER -> DTO : vaccineType = getVaccineType()
activate DTO
deactivate DTO

MAPPER -> DTO : sms = getSms() 
activate DTO
deactivate DTO


MAPPER -> APPSTORE : create(SNSUserNumber,date,time,center,vaccineType,SMS)
activate APPSTORE

APPSTORE -> APPOINT** : create(SNSUserNumber,date,time,vaccineType,SMS)
deactivate MAPPER
deactivate APPSTORE

CTRL -> APPSTORE : validateAppointment()
activate APPSTORE
deactivate CTRL
deactivate APPSTORE


UI --> RECEPT : shows all data and requests confirmation
deactivate UI
RECEPT -> UI : confirms the data
activate UI

UI -> CTRL : saveAppointment()
activate CTRL

CTRL -> APPSTORE : saveAppointment(appointment)
activate APPSTORE

APPSTORE -> APPSTORE : checkDuplicates()
activate APPSTORE
deactivate APPSTORE

APPSTORE -> APPSTORE : addAppointment()
activate APPSTORE
deactivate APPSTORE
deactivate APPSTORE
deactivate CTRL

UI --> RECEPT : informs operation success
deactivate UI

deactivate RECEPT

@enduml
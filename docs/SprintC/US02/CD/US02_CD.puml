@startuml US02_CD
skinparam classAttributeIconSize 0

class Appointment {
  - snsUser : SNSUser
  - date : Date
  - center : VaccinationCenter
  - vaccineType : VaccineType
  - sms : boolean
  +Appointment(SNSUserNumber, date, center, vaccineType, sms)
  +isSMS()
  +getVaccinationCenter()
  +getSnsUser()
  +getDate()
  +getVaccineType()
}

class AppointmentScheduleList {
  -appointments: Map<Calendar, Appointment[][]>
  -slotsPerDay : int
  -vaccinesPerSlot: int
  +create(snsUser,date,center,vaccineType,sms)
  +saveAppointment(appointment)
  +hasAppointmentToday(snsNumber)
  +isValdSchedule(date)
  +validateAppointment(appointment)
  +checkSlotAvailability(date)

  -existsScheduleForDay(date)
  -getAppointmentSlotIndex(date)
}

class Vaccine   {
  -designation : String
  -brand : String
  -id : String
  -vacType : VaccineType

  +Vaccine(designation, id, brand, vacTypeId)
}

class ScheduleVaccineReceptionistUI {}

class ScheduleVaccineController {
  +createAppointment(snsNumber,date,center,vaccineType,sms)
  +getSuggestedVaccineType()
  +existsUser(snsNumber)
  +userHasTakenAnyVaccineFromVaccineType(vaccineType,snsNumber)
  +checkAdministrationProcessForVaccineType(vaccineType)
  +isCenterOpenAt(center,hours)
  +hasSlotAvailability(center,date)
  +userHasAppointmentForVaccineType(vaccineType,snsNumber)
  +getVaccineTypeByCode(code)
  +getVaccinationCenterByEmail(email)
  +getListOfVaccinationCentersWithVaccineType(vaccineType)
  +getListOfVaccineTypes()
  +save()
  +stringifyData()

}

class Company {
  -designation: String
  +getSuggestedVaccineType()
  +getVaccinationCenterStore()
  +getVaccineTypeStore()
}

class SNSUser {
  - citizenCard: String 
  - snsNumber: String 
  - birthDay: Date 
  - gender: Char
  - phoneNumber: String 
  - address: String
  - userHealthData : UserHealthData
  + SNSUser(citizenCard, snsNumber, name, birthDay, gender, phoneNumber, email, address)
  }

class UserHealthData {
 - vaccinesTaken: List<VaccinationData>
 +isEligibleForVaccine(vaccineType)
}

class VaccinationData {
  - batchNumber: int
  - nOfDose: int
  - date: Date
}

class VaccinationCenter{
  - name: String
  - address: String
  - emailAddress: String
  - phoneNumber: String
  - faxNumber: String
  - websiteAddress: String
  +VaccinationCenter(name,address,emailAddres,phoneNumber,faxNumber,websiteAddress,openingHours,closingHours,slotDuration,maximumVaccinesPerSlot,coordinator)
  +getAdministeredVaccines()
  +checkAvailability(date,time,vaccineType)
  +addAppointmentToList(appointment)
}

class Time {
  - hours : int
  - minutes : int
}

class Slot {
  - slotDuration : int
  - maxVacPerSlot : int
}

class VaccinationCenterStore {
-availableVaccinationCentersList: List<VaccinationCenter>
+getVaccinationCenterByVaccineType(vaccineType)
}

class VaccineType {}

class VaccineTypeStore {
  -vaccineTypes : List<VaccineType>
  +getVaccineTypes()
}

class SMSSender {
  +sendSMS(phoneNumber,message)
}

class VaccineTypeMapper {
+toDto(vaccineTypes)
}

class VaccinationCenterMapper {
  +toDto(vaccinationCenters)
}

class AppointmentInsertMapper {
  +toDto(appointment)
}

class AppointmentInsertDto {
  -snsUserNumber : String
  -vaccineTypeDescription : String
  -centerName : String
  -date : String
  -sms: String
  +getSNSNumber()
  +getDate()
  +getCenter()
  +getVaccineType()
  +getSmsPermission()
  +toString()
}

class SNSUserStore {
  +checkSNSUserExists(snsNumber)                           
}

class CommunityMassVaccinationCenter {}

class HealthCareCenter {}


ScheduleVaccineReceptionistUI ..> ScheduleVaccineController

ScheduleVaccineController ..> Company
ScheduleVaccineController <-- AppointmentInsertDto
ScheduleVaccineController --> ScheduleVaccineReceptionistUI
ScheduleVaccineController ..> VaccinationCenterMapper
ScheduleVaccineController ..> VaccineTypeMapper 

Company ..> VaccinationCenterStore
Company ..> VaccineTypeStore
Company ..> AppointmentScheduleList
Company ..> SNSUserStore

VaccinationCenterStore "1" --> "*" VaccinationCenter : stores
VaccinationCenterStore ..> Vaccine

SNSUser "1" --o "*" Appointment

AppointmentScheduleList "1" --> "*" Appointment : stores

VaccinationData o-- Vaccine
VaccinationData o--  VaccinationCenter

UserHealthData  --o SNSUser
UserHealthData "1" -- "*" VaccinationData : stores >

Appointment o-- VaccineType

Notification "0..1" <-- "1" Appointment : triggers <

Notification <|-- SMSSender
Notification <|-- EmailSender
Notification <|-- ConsoleSender

VaccineType --o Vaccine 

VaccineTypeStore --> VaccineType : stores > 

SNSUserStore --> SNSUser : stores

VaccinationCenter <|-- CommunityMassVaccinationCenter
VaccinationCenter <|-- HealthCareCenter
VaccinationCenter "1" --o "*" Appointment
VaccinationCenter "1" --> "1" Slot : has >
VaccinationCenter "1" --> "1" Time : has >

AppointmentInsertMapper --> AppointmentInsertDto
Appointment --> AppointmentInsertMapper


@enduml
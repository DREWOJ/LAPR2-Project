@startuml
autonumber
'hide footbox
actor "Nurse" as NURSE

participant ":ListUsersInWaitingRoomUI" as UI
participant ":ListUsersInWaitingRoomController" as CTRL
participant "comp\n:Company" as COMP
participant "vaccinationCenterStore\n:VaccinationCenterStore" as VACS
participant ":VaccinationCenterMapper" as VACM
participant ":AppointmentMapper" as APOM
participant "appointment:Appointment" as APO

activate NURSE
NURSE -> UI : asks to list users in waiting room for a given vaccination center
activate UI
activate CTRL
UI -> CTRL : vaccinationCenter=getVaccinationCenters()
CTRL -> COMP : vaccinationCenterStore=getVaccinationCenterStore()
activate COMP
deactivate COMP

CTRL -> VACS : vaccinationCenters=getVaccinationCenters()
activate VACS
|||
deactivate VACS
CTRL -> VACM : vaccinationCentersDto=toDto(vaccinationCenters)
activate VACM
deactivate VACM
deactivate CTRL

UI --> NURSE : shows all vaccination centers and asks to select one
deactivate UI

NURSE -> UI : selects a vaccination center
activate UI

UI -> CTRL : getWaitingRoomListFromCenter(centerId)
activate CTRL

CTRL -> VACS : waitingRoom=getWaitingRoom(centerId)
activate VACS
deactivate VACS

CTRL -> APOM : waitingRoomDto=toDto(waitingRoom)
activate APOM

create "waitingRoomDto:\nList<AppointmentDto>" as WAITDTO

APOM -> WAITDTO

loop for each appointment in waitingRoom
|||
  APOM -> APO : username=appointment.getUserName()
  APOM -> APOM : placeInLine=i

  create "AppointmentDto\n:AppointmentDto" as APODTO
  APOM -> APODTO : create(username, i)

  APOM -> WAITDTO : add(appointmentDto)
|||
end

|||
APOM --> CTRL : appointmentDto 

deactivate APOM

CTRL --> UI: waitingRoomDto

deactivate COMP
deactivate CTRL
UI --> NURSE : informs operation success
UI --> NURSE: shows list of users waiting in vaccination center
deactivate UI

deactivate UI
deactivate CTRL
deactivate NURSE

participant "vaccinationCenters:\nList<VaccinationCenter>"
participant "vaccinationCentersDto:\nList<VaccinationCenterDTO>"
participant "waitingRoom:\nList<Appointment>"

@enduml
